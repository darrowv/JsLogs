!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("./matchesonscrollbar")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./matchesonscrollbar"],t):t(CodeMirror)}(function(i){"use strict";var o={style:"matchhighlight",minChars:2,delay:100,wordsOnly:!1,annotateScrollbar:!1,showToken:!1,trim:!0};function n(t){for(var e in this.options={},o)this.options[e]=(t&&t.hasOwnProperty(e)?t:o)[e];this.overlay=this.timeout=null,this.matchesonscroll=null,this.active=!1}function r(t){var e=t.state.matchHighlighter;(e.active||t.hasFocus())&&a(t,e)}function s(t){var e=t.state.matchHighlighter;e.active||(e.active=!0,a(t,e))}function a(t,e){clearTimeout(e.timeout),e.timeout=setTimeout(function(){h(t)},e.options.delay)}function c(t,e,o,i){var n,r,s,a=t.state.matchHighlighter;t.addOverlay(a.overlay=(n=e,r=o,s=i,{token:function(t){if(t.match(n)&&(!r||(o=r,!((e=t).start&&o.test(e.string.charAt(e.start-1))||e.pos!=e.string.length&&o.test(e.string.charAt(e.pos))))))return s;var e,o;t.next(),t.skipTo(n.charAt(0))||t.skipToEnd()}})),a.options.annotateScrollbar&&t.showMatchesOnScrollbar&&(i=o?new RegExp((/\w/.test(e.charAt(0))?"\\b":"")+e.replace(/[\\\[.+*?(){|^$]/g,"\\$&")+(/\w/.test(e.charAt(e.length-1))?"\\b":"")):e,a.matchesonscroll=t.showMatchesOnScrollbar(i,!1,{className:"CodeMirror-selection-highlight-scrollbar"}))}function l(t){var e=t.state.matchHighlighter;e.overlay&&(t.removeOverlay(e.overlay),e.overlay=null,e.matchesonscroll&&(e.matchesonscroll.clear(),e.matchesonscroll=null))}function h(a){a.operation(function(){var t=a.state.matchHighlighter;if(l(a),!a.somethingSelected()&&t.options.showToken){for(var e=!0===t.options.showToken?/[\w$]/:t.options.showToken,o=a.getCursor(),i=a.getLine(o.line),n=o.ch,r=n;n&&e.test(i.charAt(n-1));)--n;for(;r<i.length&&e.test(i.charAt(r));)++r;n<r&&c(a,i.slice(n,r),e,t.options.style)}else{var o=a.getCursor("from"),s=a.getCursor("to");o.line!=s.line||t.options.wordsOnly&&!function(t,e,o){{if(null===t.getRange(e,o).match(/^\w+$/))return;if(0<e.ch){var i={line:e.line,ch:e.ch-1};if(null===t.getRange(i,e).match(/\W/))return}if(o.ch<t.getLine(e.line).length){i={line:o.line,ch:o.ch+1};if(null===t.getRange(o,i).match(/\W/))return}return 1}}(a,o,s)||(o=a.getRange(o,s),(o=t.options.trim?o.replace(/^\s+|\s+$/g,""):o).length>=t.options.minChars&&c(a,o,!1,t.options.style))}})}i.defineOption("highlightSelectionMatches",!1,function(t,e,o){o&&o!=i.Init&&(l(t),clearTimeout(t.state.matchHighlighter.timeout),t.state.matchHighlighter=null,t.off("cursorActivity",r),t.off("focus",s)),e&&(o=t.state.matchHighlighter=new n(e),t.hasFocus()?(o.active=!0,h(t)):t.on("focus",s),t.on("cursorActivity",r))})});